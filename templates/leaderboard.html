{% extends "base.html" %}
{% block title %}Leaderboard - Top Traders{% endblock %}
{% block meta_title %}MIMIC Leaderboard - Top Crypto Copy Traders 2025 | Live Performance{% endblock %}
{% block meta_description %}See real-time leaderboard of top crypto copy traders on MIMIC. View Master Trader performance, ROE%, and profit stats. Join the best copy trading platform and start earning today!{% endblock %}
{% block meta_keywords %}crypto leaderboard, top traders, copy trading performance, trading stats, ROE percentage, master trader, crypto profits, binance top traders, best copy traders 2025{% endblock %}
{% block og_title %}MIMIC Leaderboard - Top Crypto Copy Traders Performance{% endblock %}
{% block og_description %}Track the best crypto traders in real-time. See Master Trader stats, top copier profits, and join the winning team. Start copy trading today!{% endblock %}
{% block twitter_title %}MIMIC Leaderboard - Live Top Trader Stats{% endblock %}

{% block structured_data %}
<!-- Leaderboard Schema -->
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "MIMIC Crypto Trading Leaderboard",
    "description": "Real-time leaderboard of top performing crypto copy traders",
    "url": "https://mimic.cash/leaderboard",
    "mainEntity": {
        "@type": "ItemList",
        "name": "Top Copy Traders",
        "description": "Ranked list of top performing copy traders by ROE%",
        "itemListElement": []
    },
    "breadcrumb": {
        "@type": "BreadcrumbList",
        "itemListElement": [
            {
                "@type": "ListItem",
                "position": 1,
                "name": "Home",
                "item": "https://mimic.cash/"
            },
            {
                "@type": "ListItem",
                "position": 2,
                "name": "Leaderboard",
                "item": "https://mimic.cash/leaderboard"
            }
        ]
    }
}
</script>
{% endblock %}

{% block extra_styles %}
<style>
    /* ============= LEADERBOARD PAGE STYLES ============= */
    .leaderboard-hero {
        padding: 80px 24px 60px;
        text-align: center;
        position: relative;
        overflow: hidden;
    }
    
    .leaderboard-hero::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 1000px;
        height: 1000px;
        background: 
            radial-gradient(ellipse at center, rgba(57, 255, 20, 0.08) 0%, transparent 40%),
            radial-gradient(ellipse at 30% 70%, rgba(0, 240, 255, 0.06) 0%, transparent 40%);
        pointer-events: none;
        animation: heroGlow 12s ease-in-out infinite;
    }
    
    @keyframes heroGlow {
        0%, 100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        50% { opacity: 0.7; transform: translate(-50%, -50%) scale(1.1); }
    }
    
    .leaderboard-hero h1 {
        font-family: var(--font-cyber);
        font-size: clamp(2rem, 6vw, 3.5rem);
        font-weight: 900;
        margin-bottom: 16px;
        position: relative;
        z-index: 1;
    }
    
    .leaderboard-hero h1 .gradient {
        background: linear-gradient(90deg, var(--neon-green), var(--neon-cyan));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    .leaderboard-hero p {
        font-size: 1.1rem;
        color: var(--text-secondary);
        max-width: 600px;
        margin: 0 auto;
        position: relative;
        z-index: 1;
    }
    
    /* ============= GLOBAL STATS GRID ============= */
    .global-stats {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        max-width: 1200px;
        margin: 0 auto 60px;
        padding: 0 24px;
    }
    
    @media (max-width: 1024px) {
        .global-stats { grid-template-columns: repeat(2, 1fr); }
    }
    
    @media (max-width: 640px) {
        .global-stats { grid-template-columns: 1fr; }
    }
    
    .stat-card {
        background: linear-gradient(135deg, rgba(10, 10, 18, 0.95), rgba(15, 15, 24, 0.95));
        border: 1px solid rgba(0, 240, 255, 0.15);
        border-radius: var(--radius-xl);
        padding: 28px;
        text-align: center;
        position: relative;
        overflow: hidden;
        transition: all 0.4s var(--ease-out);
    }
    
    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--gradient-primary);
        opacity: 0;
        transition: opacity 0.3s;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        border-color: rgba(0, 240, 255, 0.3);
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4), 0 0 40px rgba(0, 240, 255, 0.1);
    }
    
    .stat-card:hover::before {
        opacity: 1;
    }
    
    .stat-card .icon {
        width: 56px;
        height: 56px;
        background: rgba(57, 255, 20, 0.1);
        border: 1px solid rgba(57, 255, 20, 0.2);
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 16px;
        font-size: 1.5rem;
        color: var(--neon-green);
    }
    
    .stat-card .icon.cyan { color: var(--neon-cyan); background: rgba(0, 240, 255, 0.1); border-color: rgba(0, 240, 255, 0.2); }
    .stat-card .icon.pink { color: var(--neon-pink); background: rgba(255, 45, 146, 0.1); border-color: rgba(255, 45, 146, 0.2); }
    .stat-card .icon.purple { color: var(--neon-purple); background: rgba(139, 92, 246, 0.1); border-color: rgba(139, 92, 246, 0.2); }
    
    .stat-card .value {
        font-family: var(--font-mono);
        font-size: 2rem;
        font-weight: 700;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 8px;
    }
    
    .stat-card .label {
        font-size: 0.85rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.1em;
        font-family: var(--font-mono);
    }
    
    /* ============= MAIN CONTENT LAYOUT ============= */
    .leaderboard-content {
        display: grid;
        grid-template-columns: 1fr 1.2fr;
        gap: 32px;
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 24px 80px;
    }
    
    @media (max-width: 1200px) {
        .leaderboard-content {
            grid-template-columns: 1fr;
        }
    }
    
    /* ============= TOP COPIERS TABLE ============= */
    .copiers-section {
        background: linear-gradient(135deg, rgba(10, 10, 18, 0.95), rgba(15, 15, 24, 0.95));
        border: 1px solid rgba(0, 240, 255, 0.12);
        border-radius: var(--radius-2xl);
        overflow: hidden;
    }
    
    .section-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 24px 28px;
        border-bottom: 1px solid rgba(0, 240, 255, 0.1);
        background: rgba(0, 0, 0, 0.3);
    }
    
    .section-header h2 {
        font-family: var(--font-display);
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .section-header h2 i {
        color: var(--neon-cyan);
    }
    
    .section-badge {
        font-size: 0.7rem;
        font-family: var(--font-mono);
        padding: 6px 14px;
        background: rgba(57, 255, 20, 0.1);
        border: 1px solid rgba(57, 255, 20, 0.3);
        border-radius: 100px;
        color: var(--neon-green);
        text-transform: uppercase;
        letter-spacing: 0.1em;
    }
    
    .copiers-table {
        width: 100%;
    }
    
    .copiers-table thead {
        background: rgba(0, 0, 0, 0.2);
    }
    
    .copiers-table th {
        padding: 14px 20px;
        font-size: 0.75rem;
        font-family: var(--font-mono);
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.1em;
        text-align: left;
        font-weight: 600;
    }
    
    .copiers-table th:last-child,
    .copiers-table td:last-child {
        text-align: right;
    }
    
    .copiers-table tbody tr {
        border-bottom: 1px solid rgba(0, 240, 255, 0.05);
        transition: background 0.2s;
    }
    
    .copiers-table tbody tr:hover {
        background: rgba(0, 240, 255, 0.03);
    }
    
    .copiers-table tbody tr:last-child {
        border-bottom: none;
    }
    
    .copiers-table td {
        padding: 16px 20px;
        font-size: 0.95rem;
    }
    
    .rank-badge {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-family: var(--font-mono);
        font-weight: 700;
        font-size: 0.85rem;
    }
    
    .rank-badge.gold {
        background: linear-gradient(135deg, #ffd700, #ffaa00);
        color: #000;
        box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
    }
    
    .rank-badge.silver {
        background: linear-gradient(135deg, #c0c0c0, #a0a0a0);
        color: #000;
    }
    
    .rank-badge.bronze {
        background: linear-gradient(135deg, #cd7f32, #a06020);
        color: #fff;
    }
    
    .rank-badge.normal {
        background: rgba(0, 240, 255, 0.1);
        color: var(--text-muted);
    }
    
    .user-name {
        font-family: var(--font-mono);
        color: var(--text-primary);
    }
    
    .roe-value {
        font-family: var(--font-mono);
        font-weight: 600;
    }
    
    .roe-value.positive {
        color: var(--neon-green);
    }
    
    .roe-value.negative {
        color: var(--neon-red);
    }
    
    .pnl-value {
        font-family: var(--font-mono);
        font-weight: 600;
    }
    
    .pnl-value.positive {
        color: var(--neon-green);
    }
    
    .pnl-value.negative {
        color: var(--neon-red);
    }
    
    .no-data-row {
        text-align: center;
        padding: 40px 20px !important;
        color: var(--text-muted);
    }
    
    /* ============= MASTER TRADER SECTION ============= */
    .master-section {
        background: linear-gradient(135deg, rgba(10, 10, 18, 0.95), rgba(15, 15, 24, 0.95));
        border: 1px solid rgba(255, 45, 146, 0.15);
        border-radius: var(--radius-2xl);
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }
    
    .master-section .section-header {
        border-bottom-color: rgba(255, 45, 146, 0.1);
    }
    
    .master-section .section-header h2 i {
        color: var(--neon-pink);
    }
    
    .master-section .section-badge {
        background: rgba(255, 45, 146, 0.1);
        border-color: rgba(255, 45, 146, 0.3);
        color: var(--neon-pink);
    }
    
    .master-stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
        padding: 24px 28px;
        border-bottom: 1px solid rgba(255, 45, 146, 0.1);
    }
    
    .master-stat {
        text-align: center;
        padding: 16px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: var(--radius-lg);
    }
    
    .master-stat .value {
        font-family: var(--font-mono);
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 4px;
    }
    
    .master-stat .value.green {
        color: var(--neon-green);
    }
    
    .master-stat .value.pink {
        color: var(--neon-pink);
    }
    
    .master-stat .value.cyan {
        color: var(--neon-cyan);
    }
    
    .master-stat .value.purple {
        color: var(--neon-purple);
    }
    
    .master-stat .label {
        font-size: 0.75rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.08em;
    }
    
    .master-chart-container {
        flex: 1;
        padding: 20px 28px 28px;
        min-height: 280px;
        position: relative;
    }
    
    .chart-placeholder {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
        min-height: 200px;
        color: var(--text-muted);
        font-family: var(--font-mono);
    }
    
    /* ============= CTA SECTION ============= */
    .leaderboard-cta {
        max-width: 900px;
        margin: 40px auto 80px;
        padding: 0 24px;
    }
    
    .cta-box {
        background: linear-gradient(135deg, rgba(10, 10, 18, 0.98), rgba(15, 15, 24, 0.98));
        border: 1px solid rgba(57, 255, 20, 0.2);
        border-radius: var(--radius-2xl);
        padding: 48px;
        text-align: center;
        position: relative;
        overflow: hidden;
    }
    
    .cta-box::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--neon-green), var(--neon-cyan), var(--neon-green));
    }
    
    .cta-box::after {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 200px;
        height: 200px;
        background: radial-gradient(circle at top right, rgba(57, 255, 20, 0.1), transparent 70%);
    }
    
    .cta-box h3 {
        font-family: var(--font-cyber);
        font-size: clamp(1.5rem, 4vw, 2.25rem);
        font-weight: 900;
        margin-bottom: 16px;
        position: relative;
        z-index: 1;
    }
    
    .cta-box p {
        font-size: 1.05rem;
        color: var(--text-secondary);
        max-width: 500px;
        margin: 0 auto 32px;
        line-height: 1.7;
        position: relative;
        z-index: 1;
    }
    
    .cta-box .cyber-btn {
        position: relative;
        z-index: 1;
    }
    
    /* ============= LOADING STATE ============= */
    .loading-shimmer {
        background: linear-gradient(90deg, 
            rgba(0, 240, 255, 0.05) 0%, 
            rgba(0, 240, 255, 0.1) 50%, 
            rgba(0, 240, 255, 0.05) 100%);
        background-size: 200% 100%;
        animation: shimmer 1.5s infinite;
    }
    
    @keyframes shimmer {
        0% { background-position: -200% 0; }
        100% { background-position: 200% 0; }
    }
    
    .loading-pulse {
        animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
        0%, 100% { opacity: 0.5; }
        50% { opacity: 1; }
    }
</style>
{% endblock %}

{% block content %}
<!-- ==================== HERO SECTION ==================== -->
<section class="leaderboard-hero">
    <h1>
        <span class="gradient" data-i18n="leaderboard.title">Leaderboard</span>
    </h1>
    <p data-i18n="leaderboard.subtitle">Real-time performance tracking of our top copy traders. See who's leading the pack.</p>
</section>

<!-- ==================== GLOBAL STATS ==================== -->
<section class="global-stats">
    <div class="stat-card animate-slide-up">
        <div class="icon cyan">
            <i class="fas fa-users"></i>
        </div>
        <div class="value" id="stat-users">-</div>
        <div class="label" data-i18n="leaderboard.totalUsers">Total Users</div>
    </div>
    
    <div class="stat-card animate-slide-up" style="animation-delay: 0.1s;">
        <div class="icon">
            <i class="fas fa-chart-bar"></i>
        </div>
        <div class="value" id="stat-volume">-</div>
        <div class="label" data-i18n="leaderboard.totalVolume">Total Volume</div>
    </div>
    
    <div class="stat-card animate-slide-up" style="animation-delay: 0.2s;">
        <div class="icon pink">
            <i class="fas fa-coins"></i>
        </div>
        <div class="value" id="stat-profit">-</div>
        <div class="label" data-i18n="leaderboard.totalProfit">Total Profit</div>
    </div>
    
    <div class="stat-card animate-slide-up" style="animation-delay: 0.3s;">
        <div class="icon purple">
            <i class="fas fa-exchange-alt"></i>
        </div>
        <div class="value" id="stat-trades">-</div>
        <div class="label" data-i18n="leaderboard.totalTrades">Total Trades</div>
    </div>
</section>

<!-- ==================== MAIN CONTENT ==================== -->
<section class="leaderboard-content">
    <!-- Top Copiers Table -->
    <div class="copiers-section animate-slide-up" style="animation-delay: 0.4s;">
        <div class="section-header">
            <h2><i class="fas fa-trophy"></i> <span data-i18n="leaderboard.topCopiers">Top Copiers</span></h2>
            <span class="section-badge" id="copiers-badge" data-i18n="leaderboard.today">Today</span>
        </div>
        <table class="copiers-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th data-i18n="leaderboard.trader">Trader</th>
                    <th data-i18n="leaderboard.trades">Trades</th>
                    <th>ROE%</th>
                    <th>PnL</th>
                </tr>
            </thead>
            <tbody id="copiers-tbody">
                <tr>
                    <td colspan="5" class="no-data-row loading-pulse" data-i18n="leaderboard.loadingLeaderboard">Loading leaderboard...</td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <!-- Master Trader Section -->
    <div class="master-section animate-slide-up" style="animation-delay: 0.5s;">
        <div class="section-header">
            <h2><i class="fas fa-crown"></i> <span data-i18n="leaderboard.masterTrader">Master Trader</span></h2>
            <span class="section-badge" data-i18n="leaderboard.30DayPerformance">30 Day Performance</span>
        </div>
        
        <div class="master-stats-grid">
            <div class="master-stat">
                <div class="value green" id="master-pnl">-</div>
                <div class="label" data-i18n="leaderboard.totalPnl">Total PnL</div>
            </div>
            <div class="master-stat">
                <div class="value pink" id="master-roe">-</div>
                <div class="label">ROE %</div>
            </div>
            <div class="master-stat">
                <div class="value cyan" id="master-winrate">-</div>
                <div class="label" data-i18n="leaderboard.winRate">Win Rate</div>
            </div>
            <div class="master-stat">
                <div class="value purple" id="master-trades">-</div>
                <div class="label" data-i18n="leaderboard.trades">Trades</div>
            </div>
        </div>
        
        <div class="master-chart-container">
            <canvas id="masterPerformanceChart"></canvas>
        </div>
    </div>
</section>

<!-- ==================== CTA SECTION ==================== -->
<section class="leaderboard-cta">
    <div class="cta-box animate-slide-up" style="animation-delay: 0.6s;">
        <h3 data-i18n="leaderboard.readyToJoin">Ready to Join the Winners?</h3>
        <p data-i18n="leaderboard.readyToJoinSubtitle">Start copy trading today and automatically mirror the trades of our top performers. No experience required.</p>
        <a href="{{ url_for('register') }}" class="cyber-btn cyber-btn-green cyber-btn-lg">
            <i class="fas fa-rocket"></i>
            <span data-i18n="leaderboard.copyNow">Copy Now â€” Start Free</span>
        </a>
    </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
// Format numbers for display
function formatNumber(num) {
    if (num >= 1000000) {
        return '$' + (num / 1000000).toFixed(2) + 'M';
    } else if (num >= 1000) {
        return '$' + (num / 1000).toFixed(1) + 'K';
    }
    return '$' + num.toFixed(2);
}

function formatCount(num) {
    if (num >= 1000000) {
        return (num / 1000000).toFixed(1) + 'M';
    } else if (num >= 1000) {
        return (num / 1000).toFixed(1) + 'K';
    }
    return num.toString();
}

// Master Performance Chart
let masterChart = null;

function createMasterChart(data) {
    const ctx = document.getElementById('masterPerformanceChart');
    if (!ctx) return;
    
    if (masterChart) {
        masterChart.destroy();
    }
    
    // Create gradient
    const gradient = ctx.getContext('2d').createLinearGradient(0, 0, 0, 250);
    gradient.addColorStop(0, 'rgba(255, 45, 146, 0.3)');
    gradient.addColorStop(0.5, 'rgba(255, 45, 146, 0.1)');
    gradient.addColorStop(1, 'rgba(255, 45, 146, 0)');
    
    masterChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: data.map(d => d.time),
            datasets: [{
                label: 'Balance',
                data: data.map(d => d.balance),
                borderColor: '#ff2d92',
                backgroundColor: gradient,
                fill: true,
                tension: 0.4,
                pointRadius: 0,
                pointHoverRadius: 6,
                pointHoverBackgroundColor: '#ff2d92',
                pointHoverBorderColor: '#fff',
                pointHoverBorderWidth: 2,
                borderWidth: 2.5
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
                intersect: false,
                mode: 'index'
            },
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: 'rgba(10, 10, 18, 0.95)',
                    titleColor: '#fff',
                    bodyColor: '#ff2d92',
                    borderColor: 'rgba(255, 45, 146, 0.3)',
                    borderWidth: 1,
                    padding: 12,
                    displayColors: false,
                    callbacks: {
                        label: function(context) {
                            return '$' + context.parsed.y.toLocaleString('en-US', {minimumFractionDigits: 2});
                        }
                    }
                }
            },
            scales: {
                x: {
                    display: true,
                    grid: {
                        color: 'rgba(255, 255, 255, 0.03)',
                        drawBorder: false
                    },
                    ticks: {
                        color: '#555',
                        font: { size: 10, family: 'JetBrains Mono' },
                        maxTicksLimit: 8
                    }
                },
                y: {
                    display: true,
                    grid: {
                        color: 'rgba(255, 255, 255, 0.03)',
                        drawBorder: false
                    },
                    ticks: {
                        color: '#555',
                        font: { size: 10, family: 'JetBrains Mono' },
                        callback: function(value) {
                            return '$' + value.toLocaleString();
                        }
                    }
                }
            },
            animation: {
                duration: 1000,
                easing: 'easeOutQuart'
            }
        }
    });
}

// Load leaderboard data
function loadLeaderboardData() {
    fetch('/api/leaderboard/stats')
        .then(response => response.json())
        .then(data => {
            if (!data.success) {
                console.error('Failed to load leaderboard:', data.error);
                return;
            }
            
            // Update global stats
            const globalStats = data.global_stats;
            document.getElementById('stat-users').textContent = formatCount(globalStats.total_users);
            document.getElementById('stat-volume').textContent = formatNumber(globalStats.total_volume);
            document.getElementById('stat-profit').textContent = formatNumber(globalStats.total_profit);
            document.getElementById('stat-trades').textContent = formatCount(globalStats.total_trades);
            
            // Update top copiers table
            const tbody = document.getElementById('copiers-tbody');
            if (data.top_copiers && data.top_copiers.length > 0) {
                tbody.innerHTML = data.top_copiers.map((copier, index) => {
                    const rank = index + 1;
                    let rankClass = 'normal';
                    if (rank === 1) rankClass = 'gold';
                    else if (rank === 2) rankClass = 'silver';
                    else if (rank === 3) rankClass = 'bronze';
                    
                    const roeClass = copier.roe >= 0 ? 'positive' : 'negative';
                    const pnlClass = copier.pnl >= 0 ? 'positive' : 'negative';
                    const roeSign = copier.roe >= 0 ? '+' : '';
                    const pnlSign = copier.pnl >= 0 ? '+' : '';
                    
                    return `
                        <tr>
                            <td><span class="rank-badge ${rankClass}">${rank}</span></td>
                            <td class="user-name">${copier.masked_name}</td>
                            <td>${copier.trades}</td>
                            <td class="roe-value ${roeClass}">${roeSign}${copier.roe.toFixed(2)}%</td>
                            <td class="pnl-value ${pnlClass}">${pnlSign}$${Math.abs(copier.pnl).toFixed(2)}</td>
                        </tr>
                    `;
                }).join('');
                
                // Update badge to show if data is from today or week
                // (The API already handles this fallback)
            } else {
                tbody.innerHTML = '<tr><td colspan="5" class="no-data-row">No trading activity yet. Be the first!</td></tr>';
            }
            
            // Update master stats
            const masterStats = data.master_stats;
            const pnlSign = masterStats.pnl_30d >= 0 ? '+' : '';
            const roeSign = masterStats.roe_30d >= 0 ? '+' : '';
            
            document.getElementById('master-pnl').textContent = pnlSign + '$' + masterStats.pnl_30d.toLocaleString('en-US', {minimumFractionDigits: 2});
            document.getElementById('master-roe').textContent = roeSign + masterStats.roe_30d.toFixed(2) + '%';
            document.getElementById('master-winrate').textContent = masterStats.winrate.toFixed(1) + '%';
            document.getElementById('master-trades').textContent = masterStats.trades_30d;
            
            // Create master chart
            if (data.balance_chart && data.balance_chart.length > 0) {
                createMasterChart(data.balance_chart);
            } else {
                document.querySelector('.master-chart-container').innerHTML = '<div class="chart-placeholder">No balance history available</div>';
            }
        })
        .catch(error => {
            console.error('Error loading leaderboard:', error);
            document.getElementById('copiers-tbody').innerHTML = '<tr><td colspan="5" class="no-data-row">Failed to load data. Please try again.</td></tr>';
        });
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    // Wait for Chart.js to be available
    if (typeof Chart !== 'undefined') {
        loadLeaderboardData();
    } else {
        // Retry after a short delay if Chart.js isn't loaded yet
        setTimeout(loadLeaderboardData, 500);
    }
    
    // Refresh data every 60 seconds
    setInterval(loadLeaderboardData, 60000);
});
</script>
{% endblock %}

