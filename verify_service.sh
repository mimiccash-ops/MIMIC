#!/bin/bash
# Verify service is running

echo "üîç –ü–µ—Ä–µ–≤—ñ—Ä—è—é —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤—ñ—Å—É mimic..."
echo ""

# 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤—ñ—Å
echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é —Å–µ—Ä–≤—ñ—Å..."
sudo systemctl restart mimic
sleep 3

# 2. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å
echo "üìã –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤—ñ—Å—É:"
sudo systemctl status mimic --no-pager -l | head -20
echo ""

# 3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ —Å–ª—É—Ö–∞—î –ø–æ—Ä—Ç 8000
echo "üìã –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ—Ä—Ç—É 8000:"
if netstat -tlnp 2>/dev/null | grep -q ':8000' || ss -tlnp 2>/dev/null | grep -q ':8000'; then
    echo "  ‚úÖ –ü–æ—Ä—Ç 8000 –≤—ñ–¥–∫—Ä–∏—Ç–∏–π"
    netstat -tlnp 2>/dev/null | grep ':8000' || ss -tlnp 2>/dev/null | grep ':8000'
else
    echo "  ‚ùå –ü–æ—Ä—Ç 8000 –Ω–µ –≤—ñ–¥–∫—Ä–∏—Ç–∏–π"
fi
echo ""

# 4. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å —á–µ—Ä–µ–∑ curl
echo "üìã –¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ:"
if curl -s -o /dev/null -w "%{http_code}" http://127.0.0.1:8000/health 2>/dev/null | grep -q "200\|404\|302"; then
    echo "  ‚úÖ –°–µ—Ä–≤—ñ—Å –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î"
else
    echo "  ‚ùå –°–µ—Ä–≤—ñ—Å –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î"
fi
echo ""

# 5. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—ñ –ª–æ–≥–∏
echo "üìã –û—Å—Ç–∞–Ω–Ω—ñ –ª–æ–≥–∏ (—è–∫—â–æ —î –ø–æ–º–∏–ª–∫–∏):"
sudo journalctl -u mimic -n 10 --no-pager | tail -10
echo ""

echo "‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
