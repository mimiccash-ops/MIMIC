#!/bin/bash
# Fix indentation in security.py

echo "üîß –í–∏–ø—Ä–∞–≤–ª—è—é –≤—ñ–¥—Å—Ç—É–ø–∏ –≤ security.py..."
echo ""

cd /var/www/mimic || exit 1

# 1. –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ä–µ–∑–µ—Ä–≤–Ω—É –∫–æ–ø—ñ—é
cp security.py security.py.backup

# 2. –í–∏–ø—Ä–∞–≤–∏—Ç–∏ —Ä—è–¥–æ–∫ 630 - –º–∞—î –º–∞—Ç–∏ 8 –ø—Ä–æ–±—ñ–ª—ñ–≤ (—è–∫ —Ä—è–¥–æ–∫ 631)
# –ó–∞–º—ñ–Ω–∏—Ç–∏ –±—É–¥—å-—è–∫—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–æ–±—ñ–ª—ñ–≤ –Ω–∞ –ø–æ—á–∞—Ç–∫—É –Ω–∞ 8 –ø—Ä–æ–±—ñ–ª—ñ–≤
sed -i '630s/^[[:space:]]*/        /' security.py

# 3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
echo "üìã –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥—Å—Ç—É–ø—ñ–≤ (—Ä—è–¥–∫–∏ 628-635):"
sed -n '628,635p' security.py
echo ""

# 4. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ Python —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
echo "üìã –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ Python —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É:"
if python3 -c "from app import app; print('‚úÖ OK')" 2>&1; then
    echo "  ‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ!"
else
    echo "  ‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è, –≤—ñ–¥–Ω–æ–≤–ª—é—é –∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ—ó –∫–æ–ø—ñ—ó"
    cp security.py.backup security.py
    exit 1
fi

echo ""
echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤—ñ—Å:"
echo "   sudo systemctl restart mimic"
